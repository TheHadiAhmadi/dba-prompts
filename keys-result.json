{
    "notes": [
        {
            "content": "Several tables store comma-separated values (e.g., SuperAdmins in GlobalSettings, Urls in Sites) which violates normalization principles and makes querying difficult. Consider creating junction tables instead.",
            "priority": 2
        },
        {
            "content": "Many tables use CHAR(36) for GUIDs as primary keys. While functional, this can impact performance compared to auto-incrementing integers or ordered GUIDs. Consider using BINARY(16) with UUID_TO_BIN() for better storage efficiency.",
            "priority": 3
        },
        {
            "content": "The schema lacks audit trail consistency. Some tables have CreatedBy/CreatedAt but not all have ModifiedBy/ModifiedAt. Consider implementing a standardized audit pattern.",
            "priority": 4
        },
        {
            "content": "Missing unique constraints on natural keys like UserName in Users, Name+SiteId combinations in Roles/Folders/Files/Pages could lead to data duplication issues.",
            "priority": 2
        }
    ],
    "constraints": [
        {
            "table": "ApiTokens",
            "column": "Key",
            "issue": "missing_unique",
            "priority": 1,
            "suggestedConstraint": "UNIQUE KEY UK_ApiTokens_Key (`Key`)",
            "reason": "API keys should be unique to prevent conflicts and security issues"
        },
        {
            "table": "Users",
            "column": "UserName",
            "issue": "missing_unique",
            "priority": 1,
            "suggestedConstraint": "UNIQUE KEY UK_Users_UserName (UserName)",
            "reason": "Usernames must be unique to ensure proper authentication"
        },
        {
            "table": "Users",
            "column": "Email",
            "issue": "missing_unique",
            "priority": 1,
            "suggestedConstraint": "UNIQUE KEY UK_Users_Email (Email)",
            "reason": "Email addresses should be unique for password recovery and user identification"
        },
        {
            "table": "Users",
            "column": "NormalizedUserName",
            "issue": "missing_unique",
            "priority": 1,
            "suggestedConstraint": "UNIQUE KEY UK_Users_NormalizedUserName (NormalizedUserName)",
            "reason": "Normalized usernames should be unique for case-insensitive lookups"
        },
        {
            "table": "Users",
            "column": "NormalizedEmail",
            "issue": "missing_unique",
            "priority": 1,
            "suggestedConstraint": "UNIQUE KEY UK_Users_NormalizedEmail (NormalizedEmail)",
            "reason": "Normalized emails should be unique for case-insensitive lookups"
        },
        {
            "table": "Roles",
            "column": "Name",
            "issue": "missing_unique",
            "priority": 2,
            "suggestedConstraint": "UNIQUE KEY UK_Roles_SiteId_Name (SiteId, Name)",
            "reason": "Role names should be unique per site to avoid confusion"
        },
        {
            "table": "Folders",
            "column": "Name",
            "issue": "missing_unique",
            "priority": 2,
            "suggestedConstraint": "UNIQUE KEY UK_Folders_SiteId_ParentId_Name (SiteId, ParentId, Name)",
            "reason": "Folder names should be unique within the same parent folder and site"
        },
        {
            "table": "Files",
            "column": "Name",
            "issue": "missing_unique",
            "priority": 2,
            "suggestedConstraint": "UNIQUE KEY UK_Files_SiteId_FolderId_Name (SiteId, FolderId, Name)",
            "reason": "File names should be unique within the same folder and site"
        },
        {
            "table": "Pages",
            "column": "Path",
            "issue": "missing_unique",
            "priority": 2,
            "suggestedConstraint": "UNIQUE KEY UK_Pages_SiteId_Path (SiteId, Path)",
            "reason": "Page paths must be unique per site to ensure proper routing"
        },
        {
            "table": "PluginDefinitions",
            "column": "Name",
            "issue": "missing_unique",
            "priority": 2,
            "suggestedConstraint": "UNIQUE KEY UK_PluginDefinitions_Name (Name)",
            "reason": "Plugin definition names should be unique to prevent conflicts"
        },
        {
            "table": "Sites",
            "column": "Name",
            "issue": "missing_not_null",
            "priority": 2,
            "suggestedConstraint": "ALTER COLUMN Name SET NOT NULL",
            "reason": "Site names should be required for identification"
        },
        {
            "table": "SettingValues",
            "column": "SettingsId",
            "issue": "missing_not_null",
            "priority": 1,
            "suggestedConstraint": "ALTER COLUMN SettingsId SET NOT NULL",
            "reason": "SettingValues must be associated with a Settings record"
        },
        {
            "table": "Filenames",
            "column": "Extension",
            "issue": "missing_not_null",
            "priority": 3,
            "suggestedConstraint": "ALTER COLUMN Extension SET NOT NULL",
            "reason": "File extensions should be required even for files without extensions (which would be empty string)"
        },
        {
            "table": "Files",
            "column": "FolderId",
            "issue": "missing_not_null",
            "priority": 1,
            "suggestedConstraint": "ALTER COLUMN FolderId SET NOT NULL",
            "reason": "Files must belong to a folder"
        },
        {
            "table": "Pages",
            "column": "ParentId",
            "issue": "suboptimal_default",
            "priority": 4,
            "suggestedConstraint": "DEFAULT NULL",
            "reason": "Page ParentId should default to NULL for root pages rather than requiring explicit NULL values"
        },
        {
            "table": "ApiTokenPolicies",
            "column": "ApiTokenId",
            "issue": "missing_not_null",
            "priority": 1,
            "suggestedConstraint": "ALTER COLUMN ApiTokenId SET NOT NULL",
            "reason": "ApiTokenPolicies must be associated with an ApiToken"
        },
        {
            "table": "PluginDefinitionTypes",
            "column": "PluginDefinitionId",
            "issue": "missing_not_null",
            "priority": 1,
            "suggestedConstraint": "ALTER COLUMN PluginDefinitionId SET NOT NULL",
            "reason": "PluginDefinitionTypes must be associated with a PluginDefinition"
        }
    ]
}